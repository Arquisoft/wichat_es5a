ifndef::imagesdir[:imagesdir: ../images]

[[section-runtime-view]]
== Vista de ejecución

=== Registrar usuario



* _Para poder jugar un usuario debe estar registrado_
* _Para registrarse se necesita un nombre de usuario y una contraseña_

[plantuml,"User registration diagram",png]
----

actor Usuario
participant "GatewayService" as GS
participant "UserService" as US
database "Base de datos" as DB

Usuario -> GS: Introducir nombre y contraseña
GS -> US: POST /adduser con el nombre y contraseña
US -> US: Validar los datos requeridos
US -> US: Encriptar contraseña
US -> DB: Guardar usuario en la base de datos
DB -> US: Confirmación de almacenamiento
US -> GS: Confirmación de registro
GS -> Usuario: Mostrar confirmación de registro exitoso

----

=== Inicio de sesión

* _Un usuario ya registrado inicia sesión para poder jugar_
* _El usuario debe introducr su nombre y contraseña correctos_

[plantuml,"Log in diagram",png]
----

actor Usuario
participant "GatewayService" as GS
participant "AuthService" as AS
database "Base de datos" as DB

Usuario -> GS: Introducir nombre y contraseña
GS -> AS: POST /login con el nombre y contraseña
AS -> AS: Validar los datos requeridos
AS -> AS: Validar formato de los datos
AS -> DB: Buscar el usuario que trata de iniciar sesión
DB -> AS: Datos del usuario
AS -> AS: Comparar contraseña utilizando bcrypt
alt Contraseña válida
    AS -> GS: Datos del usuario
    GS -> Usuario: Mostrar confirmación de inicio de sesión
else Contraseña inválida
    AS -> GS: Devolver el error(credenciales inválidas)
    GS -> Usuario: Mostrar el error de autenticación
end

----

=== Generación de preguntas en una partida

* _Las preguntas necesarias para el juego son sacadas de WikiData_

[plantuml,"Play diagram",png]
----

actor Usuario
participant "GatewayService" as GS
participant "WikiService" as WS
participant "WikiData" as WD
database "Base de datos" as DB

Usuario -> GS: Comenzar partida
loop Generación de preguntas
    GS -> WS: Pedir una pregunta
    WS -> WD: Pedir una pregunta
    WD -> WS: Devolver información de la pregunta
    WS -> GS: Devolver opciones y foto de la pregunta
    GS -> Usuario: Mostrar opciones y foto de la pregunta
    Usuario -> GS: Responder a la pregunta
    GS -> WS: Corroborar respuesta
    WS -> GS: Devolver resultado de la pregunta
    GS -> Usuario: Mostrar resultado de la pregunta
end
WS -> DB: Almacenar los resultados finales
WS -> GS: Devolver los resultados finales
GS -> Usuario: Mostrar los resultados finales

----
